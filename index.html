<html>
    <head>
    <script>
        function str2ab(str) {
            var buf = new ArrayBuffer(str.length*2); // 2 bytes for each char
            var bufView = new Uint16Array(buf);
            for (var i=0, strLen=str.length; i<strLen; i++) {
                bufView[i] = str.charCodeAt(i);
            }
            return buf;
        }
        function decrypt(data){
            window.crypto.subtle.importKey(
                "raw",
                str2ab("0123456789123456"),
                {   //this is the algorithm options
                    name: "AES-CBC",
                    length: 128
                },
                false, //whether the key is extractable (i.e. can be used in exportKey)
                ["encrypt", "decrypt"] //can be "encrypt", "decrypt", "wrapKey", or "unwrapKey"
            )
            .then(function(key){
                console.log(key)
                //returns the symmetric key
                window.crypto.subtle.decrypt(
                    {
                        name: "AES-CBC",
                        iv: new Uint8Array(16),
                    },
                    key, //from generateKey or importKey above
                    data //ArrayBuffer of the data
                )
            }).then(function(decrypted){
                //returns an ArrayBuffer containing the decrypted data
                console.log(new Uint8Array(decrypted));
            }).catch(function(err){
                console.error(err);
            });
        }

        //  var blob = new Blob( decrypted_data);
        //                 saveAs(blob, "hello world.ts");
        function processFile(evt) {
            var file = evt.target.files[0],
            reader = new FileReader();

            reader.onload = function(e) {
                var data = e.target.result;
                console.log(data)
                decrypt(data)
            }

            reader.readAsArrayBuffer(file);   
        }
    </script>
    </head>
    <body>
        <input type="file" id="file-upload" onchange="processFile(event)">
    </body>
</html>